<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Pokedex Jm</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <h1>Pok√©dex üì±</h1>

    <div class="container">
      <!-- Buscar Pok√©mon por Nome -->
      <div class="busca">
        <h3>üîç Buscar Pok√©mon por Nome</h3>
        <input type="text" id="nome" placeholder="Digite o nome do Pok√©mon" />
        <button onclick="buscarPokemon()">Buscar</button>
        <div class="resultado" id="resultado"></div>
      </div>

      <!-- Buscar Pok√©mon por Tipo -->
      <div class="busca">
        <h3>üìï Buscar Pok√©mon por Tipo</h3>
        <input type="text" id="tipo" placeholder="Digite o tipo (ex: fire)" />
        <button onclick="buscarPorTipo()">Buscar por Tipo</button>
        <div class="resultado" id="resultado-tipo"></div>
      </div>

      <!-- Listar todos os Pok√©mons -->
      <div class="busca">
        <h3>üìã Listar Pok√©mons</h3>
        <button onclick="listarPokemons()">Carregar Lista</button>
        <div class="lista" id="lista"></div>
      </div>
    </div>

    <script>
      const API_URL = "http://127.0.0.1:8000";
      const tipoLimit = 50;
      const limit = 50;

      const tipoCores = {
        fire: "#F08030",
        water: "#6890F0",
        grass: "#78C850",
        electric: "#F8D030",
        ice: "#98D8D8",
        fighting: "#C03028",
        poison: "#A040A0",
        ground: "#E0C068",
        flying: "#A890F0",
        psychic: "#F85888",
        bug: "#A8B820",
        rock: "#B8A038",
        ghost: "#705898",
        dragon: "#7038F8",
        dark: "#705848",
        steel: "#B8B8D0",
        fairy: "#EE99AC",
        normal: "#A8A878",
      };

      // Buscar Pok√©mon por nome
      async function buscarPokemon() {
        const nome = document.getElementById("nome").value.toLowerCase();
        const resultadoDiv = document.getElementById("resultado");
        resultadoDiv.innerHTML = "Carregando...";
        try {
          const resp = await fetch(`${API_URL}/pokemon/${nome}`);
          const data = await resp.json();
          if (!resp.ok)
            throw new Error(data.detail || "Erro ao buscar Pok√©mon.");
          const imgUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${data.id}.png`;
          const tiposHtml = data.tipos
            .map(
              (t) =>
                `<span class="tipo" style="background:${
                  tipoCores[t] || "#777"
                }">${t}</span>`
            )
            .join(" ");
          resultadoDiv.innerHTML = `
      <div class="card-pokemon">
        <img src="${imgUrl}" alt="${data.nome}" />
        <h3>${data.nome}</h3>
        <p>ID: <span class="pokemon-id">${data.id}</span></p>
        <p>${tiposHtml}</p>
      </div>
    `;
        } catch (err) {
          resultadoDiv.innerHTML = `<p class="erro">‚ö†Ô∏è ${err.message}</p>`;
        }
      }

      // Buscar Pok√©mon por tipo
      async function buscarPorTipo(offset = 0) {
        const tipo = document.getElementById("tipo").value.toLowerCase();
        const resultadoTipoDiv = document.getElementById("resultado-tipo");
        resultadoTipoDiv.innerHTML = "Carregando...";
        try {
          const resp = await fetch(
            `${API_URL}/pokemon/tipo/${tipo}?limit=${tipoLimit}&offset=${offset}`
          );
          const data = await resp.json();
          if (!resp.ok)
            throw new Error(data.detail || "Erro ao buscar por tipo.");

          // Buscar dados completos de cada Pok√©mon
          let listaHTML = await Promise.all(
            data.pokemons.map(async (p) => {
              const respPoke = await fetch(
                `${API_URL}/pokemon/${p.nome.toLowerCase()}`
              );
              const pokeData = respPoke.ok
                ? await respPoke.json()
                : { id: "-", tipos: [] };
              const imgUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokeData.id}.png`;
              const tiposHtml = pokeData.tipos
                .map(
                  (t) =>
                    `<span class="tipo" style="background:${
                      tipoCores[t] || "#777"
                    }">${t}</span>`
                )
                .join(" ");
              return `
        <div class="card-pokemon">
          <img src="${imgUrl}" alt="${p.nome}" />
          <h3>${p.nome}</h3>
          <p>ID: <span class="pokemon-id">${pokeData.id}</span></p>
          <p>${tiposHtml}</p>
        </div>
      `;
            })
          );

          listaHTML = listaHTML.join("");
          let botaoProximo = `<button onclick="buscarPorTipo(${
            data.next_offset
          })" ${!data.next_offset ? "disabled" : ""}>Pr√≥ximo ‚û°Ô∏è</button>`;
          let botaoAnterior = `<button onclick="buscarPorTipo(${
            data.previous_offset
          })" ${!data.previous_offset ? "disabled" : ""}>‚¨ÖÔ∏è Anterior</button>`;

          resultadoTipoDiv.innerHTML = `
      <p>Tipo: <strong>${data.tipo}</strong> | Total: ${data.quantidade_total}</p>
      <div class="lista-cards">${listaHTML}</div>
      <div class="botoes-paginacao">${botaoProximo}${botaoAnterior}</div>
    `;
        } catch (err) {
          resultadoTipoDiv.innerHTML = `<p class="erro">‚ö†Ô∏è ${err.message}</p>`;
        }
      }

      // Listar Pok√©mons
      async function listarPokemons(offset = 0) {
        const listaDiv = document.getElementById("lista");
        listaDiv.innerHTML = "Carregando...";
        try {
          const resp = await fetch(
            `${API_URL}/pokemon?limit=${limit}&offset=${offset}`
          );
          if (!resp.ok) throw new Error("Erro ao carregar lista.");
          const data = await resp.json();

          let listaHTML = await Promise.all(
            data.pokemons.map(async (p) => {
              const respPoke = await fetch(
                `${API_URL}/pokemon/${p.nome.toLowerCase()}`
              );
              const pokeData = respPoke.ok
                ? await respPoke.json()
                : { id: "-", tipos: [] };
              const imgUrl = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/${pokeData.id}.png`;
              const tiposHtml = pokeData.tipos
                .map(
                  (t) =>
                    `<span class="tipo" style="background:${
                      tipoCores[t] || "#777"
                    }">${t}</span>`
                )
                .join(" ");
              return `
        <div class="card-pokemon">
          <img src="${imgUrl}" alt="${p.nome}" />
          <h3>${p.nome}</h3>
          <p>ID: <span class="pokemon-id">${pokeData.id}</span></p>
          <p>${tiposHtml}</p>
        </div>
      `;
            })
          );

          listaHTML = listaHTML.join("");
          let botaoProximo = `<button onclick="listarPokemons(${
            data.next_offset
          })" ${!data.next_offset ? "disabled" : ""}>Pr√≥ximo ‚û°Ô∏è</button>`;
          let botaoAnterior = `<button onclick="listarPokemons(${
            data.previous_offset
          })" ${offset === 0 ? "disabled" : ""}>‚¨ÖÔ∏è Anterior</button>`;

          listaDiv.innerHTML = `<div class="lista-cards">${listaHTML}</div><div class="botoes-paginacao">${botaoProximo}${botaoAnterior}</div>`;
        } catch (err) {
          listaDiv.innerHTML = `<p class="erro">‚ö†Ô∏è ${err.message}</p>`;
        }
      }
    </script>
  </body>
</html>
